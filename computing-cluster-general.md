# Shared Virtual Machine

The course has available a Linux virtual machine on university infrastructure that we will use in programming assignments.

## About the VM

The VM has 4 vCPUs and 48 GiB of memory.  Some capacity is reserved for running system resources and is not available for compute. The VMs are accessed through SSH, and services on the VM are accessed through [SSH tunneling][sshcom-tunnel].

[sshcom-tunnel]: https://www.ssh.com/academy/ssh/tunneling

## SSH key

Access to the VM will be restricted to students and teaching assistants (external access can be considered, contact the instructor). Students need to submit a public key on the course website, which they will use to log into the VM.

For students who do not yet have an SSH key, instructions for generating one can be found under the ["Generating a new SSH key"][github-ssh-key] section of GitHub's guide. Additional information about SSH keys is available on [ssh.com][sshcom-ssh-key]'s tutorial.

If you are running Windows, an OpenSSH client may be preinstalled and
the commands in the guides above will just work. If an OpenSSH client is
not installed, you can install it directly from Microsoft following
[these instructions][microsoft-openssh-client]; you need only the
OpenSSH *client*; there is no need to install the OpenSSH *server* package.

Submit *only* the public key (i.e., the `.pub` file) created in the key
generation process. Keep the private key on (or copy it to) the
device(s) you will use to work on the assignments. Never share private
keys.

[github-ssh-key]: https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key

[sshcom-ssh-key]: https://www.ssh.com/academy/ssh/keygen

[microsoft-openssh-client]: https://docs.microsoft.com/en-us/windows-server/administration/openssh/openssh_install_firstuse#install-openssh-using-windows-settings

A user will be created for each student.

## Accessing the VM

Student `username`s will be the same as their university ID. After your account has been generated, you will be able to log into the VM using:

```{bash}
ssh <username>@<hostname>
```

A more convenient way to access the VM is by creating a `.ssh/config` file and configuring an entry for the VM. The following configuration will forward ports 8081 and 8088 on your machine to ports 8081 and 8088 on the main VM, which run the services and frameworks used in the programming assignments. You can then connect to these ports by navigating to `http://localhost:8081` and `http://localhost:8088` on your browser after SSH'ing into the main VM.

```{sshconfig}
Host cloudvm
  User <username>
  Hostname <hostname>
  Port <port>
  LocalForward 8088 <hostname>:8088
  LocalForward 8081 <hostname>:8081
```

With this configuration in place, you can connect to the VM and forward the ports by running `ssh cloudvm` in the terminal.

## Workspaces

You have two main areas to store data in the VM. The first is your
`home` directory, located at `/home/<username>`, as in any Linux machine.
You have full control of your home directory.

The second storage area is on HDFS (Hadoop's Distributed File System).
HDFS is where Hadoop and Spark applications will read data from, and
where results will be stored. As we will see in the course, HDFS
distributes data in a cluster, providing redundancy and improving
performance of applications by allowing computation to run on the same
server where data is stored. The default path for users is in a
directory given by the username, i.e., `/user/<username>`, which will be
empty if you have not done anything on the VM yet.

To check what files are in your HDFS directory, you can run the
following on the main VM:

```{bash}
$ hdfs dfs -ls /user/<login>
```

## Sharing the VM

The VM has sufficient capacity for the programming assignments, but ill-engineered or inefficient solutions may put a strain on the available resources. As the VM is shared across all students, please be considerate to your colleagues and avoid hogging compute and memory resources. Expect high VM utilization close to assignment submission dates. Plan to work on assignments early and throughout the development period to avoid high-utilization spikes.

When relevant, specify the optimal amount of resources for your applications. Do not try to change anything that is not on your workspaces. Contact the instructors if you have any questions or problems with the VM's configuration.

We have not configured disk quotas on the VM. Please be considerate with colleagues and avoid unnecessarily grabbing disk space. In particular, check output and log files generated by your programs to ensure they are not unnecessarily large.

The VM has some disaster recovery features, but data loss is likely in case of a failure. Back up your data frequently to avoid losing work.
